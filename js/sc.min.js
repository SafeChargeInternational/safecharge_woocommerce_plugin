
var isAjaxCalled=false;var manualChangedCountry=false;var tokAPMs=["cc_card","paydotcom"];var tokAPMsFields={cardNumber:"ccCardNumber",expirationMonth:"ccExpMonth",expirationYear:"ccExpYear",cardHolderName:"ccNameOnCard",CVV:""};function scValidateAPMFields(){var a=true;var b="";if(jQuery("li.apm_container").length>0){jQuery("li.apm_container").each(function(){var f=jQuery(this);var e=f.find("input.sc_payment_method_field");if(e.is(":checked")){var d=f.find(".apm_field input");b=e.val();if(typeof d.attr("pattern")!="undefined"&&d.attr("pattern")!==false&&d.attr("pattern")!=""){var g=new RegExp(d.attr("pattern"),"i");if(g.test(d.val())==false||d.val()==""){d.parent(".apm_field").find(".apm_error").removeClass("error_info").show();a=false}else{d.parent(".apm_field").find(".error").hide()}}}})}if(a){if(tokAPMs.indexOf(b)>-1){var c={merchantSiteId:"",sessionToken:"",billingAddress:{city:jQuery("#billing_city").val(),country:jQuery("#billing_country").val(),zip:jQuery("#billing_postcode").val(),email:jQuery("#billing_email").val(),firstName:jQuery("#billing_first_name").val(),lastName:jQuery("#billing_last_name").val(),},cardData:{cardNumber:jQuery("#"+b+"_"+tokAPMsFields.cardNumber).val(),cardHolderName:jQuery("#"+b+"_"+tokAPMsFields.cardHolderName).val(),expirationMonth:jQuery("#"+b+"_"+tokAPMsFields.expirationMonth).val().toString(),expirationYear:jQuery("#"+b+"_"+tokAPMsFields.expirationYear).val(),CVV:""}};jQuery.ajax({type:"POST",url:myAjax.ajaxurl,data:{needST:1,callFromJS:1},dataType:"json"}).done(function(d){console.log(d);if(d.status==1){c.merchantSiteId=d.data.merchantId;c.sessionToken=d.data.sessionToken;if(d.data.test=="yes"){c.environment="test"}}console.log(c);if(typeof Safecharge!="undefined"){Safecharge.card.createToken(c,safechargeResultHandler)}else{console.error("Safecharge Class not loaded. Reload the page and check the script!")}})}else{jQuery("form.woocommerce-checkout").submit()}}}function safechargeResultHandler(a){console.log(a)}function showErrorLikeInfo(a){jQuery("#error_"+a).addClass("error_info");if(jQuery("#error_"+a).css("display")=="block"){jQuery("#error_"+a).hide()}else{jQuery("#error_"+a).show()}}jQuery(function(){var a=jQuery("#billing_country").val();jQuery("#billing_country").change(function(){console.log("billing_country change");if(jQuery("#billing_country").val()!=a){manualChangedCountry=true;a=jQuery("#billing_country").val()}if(isAjaxCalled===false||manualChangedCountry===true){isAjaxCalled=true;jQuery.ajax({type:"POST",url:myAjax.ajaxurl,data:{country:jQuery("#billing_country").val(),callFromJS:1},dataType:"json"}).done(function(c){if(typeof c!="undefined"&&c!==null&&c.status==1&&typeof c.data.paymentMethods!="undefined"&&c.data.paymentMethods.length>0){var h="";var o=c.data.paymentMethods;h+='<ul id="sc_apms_list">';for(var g in o){var b="";if(o[g]["paymentMethodDisplayName"].length>0&&typeof o[g]["paymentMethodDisplayName"][0].message!="undefined"){b=o[g]["paymentMethodDisplayName"][0].message}var d=b;if(typeof o[g]["logoURL"]!="undefined"){d='<img src="'+o[g]["logoURL"].replace("/svg/","/svg/solid-white/")+'" alt="'+b+'">'}h+='<li class="apm_container"><div class="apm_title">'+d+'<input id="sc_payment_method_'+o[g].paymentMethod+'" type="radio" class="input-radio sc_payment_method_field" name="payment_method_sc" value="'+o[g].paymentMethod+'" /><span class=""></span></div><div class="apm_fields">';if(o[g].fields.length>0){for(var f in o[g].fields){var m="";try{m=o[g].fields[f].regex;if(m===undefined){m=""}}catch(l){}var n="";try{n=o[g].fields[f].caption[0].message;if(n===undefined){n=""}}catch(l){}var k="";try{k=o[g].fields[f].validationmessage[0].message;if(k===undefined){k=""}}catch(l){}h+='<div class="apm_field"><input id="'+o[g].paymentMethod+"_"+o[g].fields[f].name+'" name="'+o[g].paymentMethod+"["+o[g].fields[f].name+']" type="'+o[g].fields[f].type+'" pattern="'+m+'" placeholder="'+n+'" autocomplete="new-password" />';if(m!=""){h+='<span class="question_mark" onclick="showErrorLikeInfo(\'sc_'+o[g].fields[f].name+'\')"><span class="tooltip-icon"></span></span><div class="apm_error" id="error_sc_'+o[g].fields[f].name+'"><label>'+k+"</label></div>"}h+="</div>"}}h+="</div></li>"}h+="</ul>";jQuery(document).on("updated_checkout",function(){jQuery("#payment").find(".sc_apms").remove();if(h!=""){if(jQuery(".payment_method_sc:last").find("ul#sc_apms_list").length>0){jQuery(".payment_method_sc:last").find("ul#sc_apms_list").remove()}jQuery(".payment_method_sc:last").append(h);jQuery('form[name="checkout"]').attr("onsubmit","return false;");jQuery("form.woocommerce-checkout button[type=submit]").attr("type","button").attr("onclick","scValidateAPMFields()")}})}})}});jQuery("form.woocommerce-checkout").on("click",".apm_title",function(){jQuery("#sc_apms_list").find(".apm_title span").removeClass("apm_selected");jQuery("#sc_apms_list").find(".apm_fields").each(function(){var b=jQuery(this);if(b.css("display")=="block"){b.slideToggle("slow")}});jQuery(this).find("span").addClass("apm_selected");if(jQuery(this).parent("li").find(".apm_fields").html()==""){jQuery(this).parent("li").find(".apm_fields").css("border-bottom",0)}if(jQuery(this).parent("li").find(".apm_fields").css("display")=="none"){jQuery(this).parent("li").find(".apm_fields").slideToggle("slow")}jQuery("form.woocommerce-checkout").find("sc_payment_method_field").attr("checked",false);jQuery(this).find("input").attr("checked",true);jQuery(".apm_error").hide()})});